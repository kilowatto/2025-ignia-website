---
export interface Props {
  suggestedLanguage: string;
  currentLanguage: string;
}

const { suggestedLanguage, currentLanguage } = Astro.props;

// Importamos las utilidades
import { languageNames, generateLanguageUrl } from "../utils/languageDetection";

const suggestedLangInfo =
  languageNames[suggestedLanguage as keyof typeof languageNames];
const suggestionUrl = generateLanguageUrl(suggestedLanguage as any);
---

<div
  id="language-suggestion-banner"
  class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-primary via-primary to-secondary text-white shadow-xl border-b-4 border-accent2 transform -translate-y-full transition-transform duration-300 ease-out"
  role="banner"
  aria-label="Sugerencia de cambio de idioma"
  aria-live="polite"
>
  <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <div
      class="flex items-center gap-4"
      role="group"
      aria-labelledby="banner-message"
    >
      <div
        class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-primary to-primary rounded-full flex items-center justify-center border-2 border-white hover:border-accent1 hover:bg-gradient-to-br hover:from-primary hover:to-accent2 transition-all duration-300 hover:scale-110 cursor-pointer shadow-xl"
      >
        <span
          class="text-2xl transition-transform duration-300 hover:scale-110 drop-shadow-md"
          role="img"
          aria-label={`Bandera de ${suggestedLangInfo?.native}`}
          >{suggestedLangInfo?.flag}</span
        >
      </div>
      <div class="flex flex-col sm:flex-row sm:items-center sm:gap-3">
        <span
          class="font-subtitle font-bold text-lg text-white drop-shadow-lg shadow-black"
          id="banner-message"
          style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);"
        >
          {
            suggestedLanguage === "es"
              ? "¿Prefieres ver el sitio en español?"
              : suggestedLanguage === "fr"
                ? "Préférez-vous voir le site en français?"
                : "Would you like to view this site in English?"
          }
        </span>
      </div>
    </div>

    <div
      class="flex items-center gap-3"
      role="group"
      aria-label="Acciones de idioma"
    >
      <a
        href={suggestionUrl}
        class="language-banner-button bg-gradient-to-r from-white to-accent1 text-secondary px-6 py-3 rounded-lg font-subtitle font-bold text-sm hover:from-accent1 hover:to-white hover:text-primary transform hover:scale-105 transition-all duration-300 shadow-xl border-2 border-white focus:outline-none focus:ring-3 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary"
        onclick="acceptLanguageSuggestion()"
        role="button"
        tabindex="0"
        aria-label={suggestedLanguage === "es"
          ? "Cambiar el sitio web al idioma español"
          : suggestedLanguage === "fr"
            ? "Changer le site web en français"
            : "Switch website to English"}
      >
        {
          suggestedLanguage === "es"
            ? "Cambiar idioma"
            : suggestedLanguage === "fr"
              ? "Changer langue"
              : "Switch Language"
        }
      </a>

      <button
        onclick="dismissLanguageSuggestion()"
        class="bg-white/20 hover:bg-accent2 text-white hover:text-white p-3 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-primary group border-2 border-white/30 hover:border-white shadow-lg hover:shadow-xl"
        aria-label={suggestedLanguage === "es"
          ? "Descartar sugerencia de cambio de idioma"
          : suggestedLanguage === "fr"
            ? "Rejeter la suggestion de changement de langue"
            : "Dismiss language suggestion"}
        type="button"
        tabindex="0"
      >
        <svg
          class="w-5 h-5 group-hover:rotate-90 transition-transform duration-200 drop-shadow-sm"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2.5"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  // Mostrar banner con animación
  function showLanguageSuggestion() {
    const banner = document.getElementById("language-suggestion-banner");
    if (banner) {
      banner.classList.remove("-translate-y-full");
      banner.classList.add("translate-y-0");

      // Ajustar el padding del body para evitar que el banner tape contenido
      document.body.style.paddingTop = banner.offsetHeight + "px";
    }
  }

  // Ocultar banner con animación
  function hideLanguageSuggestion() {
    const banner = document.getElementById("language-suggestion-banner");
    if (banner) {
      banner.classList.add("-translate-y-full");
      banner.classList.remove("translate-y-0");

      // Remover padding del body
      document.body.style.paddingTop = "0";
    }
  }

  // Aceptar sugerencia
  (window as any).acceptLanguageSuggestion = function () {
    // Marcar que el usuario aceptó la sugerencia
    localStorage.setItem("language-suggestion-accepted", "true");
    hideLanguageSuggestion();
  };

  // Rechazar sugerencia
  (window as any).dismissLanguageSuggestion = function () {
    // Marcar que el usuario rechazó la sugerencia
    localStorage.setItem("language-suggestion-dismissed", "true");
    hideLanguageSuggestion();
  };

  // Auto-mostrar el banner después de un pequeño delay
  document.addEventListener("DOMContentLoaded", () => {
    // Verificar si ya fue mostrado/rechazado
    const dismissed = localStorage.getItem("language-suggestion-dismissed");
    const accepted = localStorage.getItem("language-suggestion-accepted");

    if (!dismissed && !accepted) {
      setTimeout(() => {
        showLanguageSuggestion();
      }, 1500); // Mostrar después de 1.5 segundos
    }
  });
</script>

<style>
  /* Asegurar que el banner esté por encima de todo */
  #language-suggestion-banner {
    z-index: 9999;
  }

  /* Animaciones más suaves y gradiente animado */
  #language-suggestion-banner {
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background-size: 300% 300%;
    animation: gradientShift 6s ease infinite;
    position: relative;
    overflow: hidden;
  }

  /* Efecto de gradiente animado más dinámico */
  @keyframes gradientShift {
    0% {
      background-position: 0% 50%;
    }
    25% {
      background-position: 100% 25%;
    }
    50% {
      background-position: 50% 100%;
    }
    75% {
      background-position: 25% 75%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Efecto de brillo más intenso */
  #language-suggestion-banner::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      rgba(248, 163, 55, 0.2),
      rgba(255, 255, 255, 0.3),
      transparent
    );
    animation: shine 4s ease-in-out infinite;
  }

  @keyframes shine {
    0% {
      left: -100%;
    }
    20% {
      left: -100%;
    }
    100% {
      left: 100%;
    }
  }

  /* Mejora del efecto hover en los botones */
  .language-banner-button {
    position: relative;
    overflow: hidden;
  }

  .language-banner-button::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    transition: left 0.5s;
  }

  .language-banner-button:hover::before {
    left: 100%;
  }

  /* Media queries para responsive */
  @media (max-width: 640px) {
    #language-suggestion-banner .flex-col {
      align-items: flex-start;
    }

    #language-suggestion-banner {
      animation: gradientShift 6s ease infinite;
    }
  }
</style>
