---
/**
 * Footer.astro
 *
 * Componente de pie de página completo del sitio Ignia Cloud.
 *
 * ESTRUCTURA:
 * 1. Logo: Ignia Cloud branding
 * 2. SitemapFooter: Mini-sitemap dinámico con todas las rutas organizadas
 * 3. ContactForm: Formulario de contacto con 4 estados y localStorage
 * 4. Copyright: Información legal
 *
 * FUNCIONALIDAD:
 * - SitemapFooter se alimenta dinámicamente de routes.* en i18n JSON
 * - ContactForm con anti-bot (Turnstile + honeypot) y persistencia (30 días)
 * - Traducciones centralizadas (footer.* en src/i18n/)
 * - Multi-idioma con detección automática de Astro.currentLocale
 *
 * CUMPLIMIENTO arquitecture.md:
 * - §2: Progressive enhancement (ContactForm funciona sin JS básico)
 * - §5: Traducciones centralizadas en i18n JSON
 * - §7: Footer sticky mencionado en arquitectura
 * - §9: HTML5 semántico (<footer role="contentinfo">)
 *
 * @see src/components/SitemapFooter.astro - Componente de sitemap dinámico
 * @see src/components/ContactForm.astro - Formulario de contacto con estados
 * @see src/scripts/contact-form.ts - Lógica cliente (validación, localStorage)
 * @see src/i18n/en.json - Traducciones footer.* (EN)
 * @see src/i18n/es.json - Traducciones footer.* (ES)
 * @see src/i18n/fr.json - Traducciones footer.* (FR)
 */
import "../styles/global.css";
import { t } from "astro-i18n";
import SitemapFooter from "./SitemapFooter.astro";
import ContactForm from "./ContactForm.astro";

// Obtener el locale actual desde Astro (normalizado)
const rawLocale = Astro.currentLocale || "en";
const locale = rawLocale.split("-")[0];
---

<footer
  class="mt-auto w-full min-h-[250px] bg-[var(--color-secondary)]"
  role="contentinfo"
  aria-labelledby="footer-heading"
>
  <img
    src="/Ignia-blanco.svg"
    alt="Ignia Cloud Logo"
    class="h-24 mx-auto pt-8 mb-4"
  />

  <!-- 
    SITEMAP FOOTER (INTEGRADO)
    
    Componente de mini-sitemap dinámico que genera automáticamente
    un mapa visual de todas las rutas del sitio organizadas por secciones.
    
    Integrado dentro del footer azul para cohesión visual.
    Usa texto blanco para contraste con el fondo azul (var(--color-secondary)).
    
    BENEFICIOS:
    1. Mejorar SEO con enlaces internos estructurados
    2. Facilitar navegación (usuarios encuentran contenido fácilmente)
    3. Reducir bounce rate con acceso rápido a todas las secciones
    4. Incluye nueva sección "Corporativo" con 6 enlaces institucionales
    
    El componente es completamente autónomo y se actualiza automáticamente
    al agregar nuevas rutas en src/i18n/*.json (zero maintenance).
  -->
  <SitemapFooter />

  <nav class="flex justify-center space-x-6 mb-6" aria-label="Footer">
    <h2 id="footer-heading" class="sr-only">Footer</h2>
  </nav>

  <!-- 
    FORMULARIO DE CONTACTO
    
    Reemplaza la anterior sección de newsletter con un formulario completo
    que permite a los usuarios contactar directamente con Ignia Cloud.
    
    CARACTERÍSTICAS:
    - 4 estados: idle, validating, success, already_submitted
    - localStorage: Previene múltiples envíos (30 días de expiración)
    - Anti-bot: Cloudflare Turnstile + honeypot + timestamp validation
    - Email hasheado: SHA-256 para privacidad en localStorage
    - UX optimizada: Transiciones suaves entre estados
    - Multi-idioma: Traducciones en footer.contact_form.*
    
    TODO (Integración Odoo SaaS):
    El formulario actualmente hace console.log() de los datos.
    Cuando Odoo SaaS esté configurado, actualizar handleFormSubmit() 
    en src/scripts/contact-form.ts para enviar a /api/contact endpoint.
  -->
  <ContactForm />

  <!-- Copyright -->
  <p class="text-center text-white text-sm mb-4">
    {t("footer.legal.copyright", undefined, { locale })}
  </p>
</footer>
